
<link rel="stylesheet" href="{{ url_for('static', filename='offices_style.css') }}">
<span class="explain_span"><img class="explain_icon" style="width: 2vw;display: block;margin: auto;margin-top: 2px;" src="/static/images/offices/question_mark.png"></span>

<table id="main_table">
    <tr>
        <td>
            {% set first_office = offices[0] %}
            <table class="up-left">              
                <tr><td></td><td><div class="transform_div"><span id="0" class="kpi_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 5.5vw; height: 5.5vw;"><img class="kpi_icon" style="width: 4vw;" src="/static/images/offices/white_bag.png"></span></div></td><td><div class="transform_div"><span id="1" class="kpi_bubble" data-tooltip="{{first_office_indexes[1]['name']}}" style="width: 3.5vw; height: 3.5vw;"><img class="kpi_icon" style="width: 2.5vw;" src="/static/images/offices/white_bag.png"></span></div></td><td></td></tr>
                <tr>         <td><div class="transform_div"><span id="2" class="kpi_bubble" data-tooltip="{{first_office_indexes[2]['name']}}" style="width: 3.5vw; height: 3.5vw;"><img class="kpi_icon" style="width: 2.5vw;" src="/static/images/offices/white_bag.png"></span></div></td><td><div class="transform_div"><span id="3" class="alert_bubble" data-tooltip="{{first_office_indexes[3]['name']}}" style="width: 4.5vw; height: 4.5vw;"><img class="kpi_icon" style="width: 3vw;" src="/static/images/offices/white_bag.png"></span></div></td><td><div class="transform_div"><span id="4" class="kpi_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 5.5vw; height: 5.5vw;"><img class="kpi_icon" style="width: 4vw;" src="/static/images/offices/white_bag.png"></span></td><td><div class="transform_div"><span id="7" class="policies_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 4.5vw; height: 4.5vw;"><img class="policies_icon" style="width: 3vw;" src="/static/images/offices/grey_bag.png"></span></div></td></tr>
                <tr>         <td><div class="transform_div"><span id="5" class="kpi_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 4.5vw; height: 4.5vw;"><img class="kpi_icon" style="width: 3vw;" src="/static/images/offices/white_bag.png"></span></div></td><td><div class="transform_div"><span id="6" class="kpi_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 5.5vw; height: 5.5vw;"><img class="kpi_icon" style="width: 4vw;" src="/static/images/offices/white_bag.png"></span></div></td><td><div class="transform_div"><span id="8" class="policies_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 4.5vw; height: 4.5vw;"><img class="kpi_icon" style="width: 3vw;" src="/static/images/offices/grey_bag.png"></span></div></td><td><div class="transform_div"><span id="9" class="policies_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 3.5vw; height: 3.5vw;"><img class="kpi_icon" style="width: 2.5vw;" src="/static/images/offices/grey_bag.png"></span></div></td></tr>
                <tr><td></td><td><div class="transform_div"><span id="10"class="policies_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 3.5vw; height: 3.5vw;"><img class="policies_icon"  style="width: 2.5vw;" src="/static/images/offices/grey_bag.png"></span></div></td><td><div class="transform_div"><span id="11" class="policies_bubble" data-tooltip="{{first_office_indexes[0]['name']}}" style="width: 3.5vw; height: 3.5vw;"><img class="kpi_icon" style="width: 2.5vw;" src="/static/images/offices/grey_bag.png"></span></div></td><td><span class="main_bubble" data-tooltip="{{first_office["name"]}}" style="background-image: url({{first_office['minister_image']}}); background-size: cover;"></span></td></tr>
            </table>
        </td>
        <td>
            {% set second_office = offices[1] %}
            <table class="up-right" style="border-bottom: 6px solid; border-image-slice: 1; border-width: 0.8vh;  border-image-source: linear-gradient(to right, #838383, #ffffff);">
                <tr><td></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 5.5vw; height: 5.5vw;"></span></div></td></tr>
                <tr>         <td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td></tr>
                <tr>         <td><div class="transform_div"><span class="policies_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="policies_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 5.5vw; height: 5.5vw;"></span></div></td></tr>
                <tr>         <td><span class="main_bubble" data-tooltip="{{second_office["name"]}}" style="background-image: url({{second_office['minister_image']}}); background-size: cover;"></span></td><td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td></td></tr>
            </table>
        </td>
    </tr>
    <tr>
        <td>
            {% set third_office = offices[2] %}
            <table class="down-left" style="border-top: 6px solid; border-image-slice: 1; border-width: 0.8vh;  border-image-source: linear-gradient(to left, #838383, #ffffff);">
                <tr><td></td><td><div class="transform_div"><span class="policies_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="policies_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><span class="main_bubble" data-tooltip="{{third_office["name"]}}" style="background-image: url({{third_office['minister_image']}}); background-size: cover;"></span></td></tr>
                <tr>         <td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td><div class="transform_div"><span class="policies_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td></tr>
                <tr>         <td><div class="transform_div"><span class="kpi_bubble" style="width: 5.5vw; height: 5.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></div></td></tr>
                <tr><td></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></div></td><td><div class="transform_div"><span class="alert_bubble" style="width: 5.5vw; height: 5.5vw;"></span></div></td><td></td></tr>
            </table>
        </td>
        <td>
            {% set forth_office = offices[3] %}
            <table class="down-right" style="border-left: 6px solid; border-image-slice: 1; border-width: 0.8vh;  border-image-source: linear-gradient( #838383, #ffffff);">
                <tr>         <td><span class="main_bubble" data-tooltip="{{forth_office["name"]}}" style="background-image: url({{forth_office['minister_image']}}); background-size: cover;"></span></td><td><div class="transform_div"><span class="policies_bubble" style="width: 3.5vw; height: 3.5vw;"></span></td><td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></td><td></td></tr>
                <tr>         <td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></td><td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 4.5vw; height: 4.5vw;"></span></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></td></tr>
                <tr>         <td><div class="transform_div"><span class="policies_bubble" style="width: 4.5vw; height: 4.5vw;"></span></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 4.5vw; height: 4.5vw;"></span></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></td></tr>
                <tr><td></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 3.5vw; height: 3.5vw;"></span></td><td><div class="transform_div"><span class="kpi_bubble" style="width: 5.5vw; height: 5.5vw;"></span></td><td></td></tr>
            </table>
        </td>
    </tr>
</table>


<dialog kpi-modal class="kpi_modal">
    <button close_modal onclick="close_moadal()" id="close_button" >X</button>

    <table style="width: 100%; margin: 0px; padding: 0px;height: 10%;">
        <tr style="height: 30px;">
            <th>
            </th>
            <th style="width: 43%;">
               
            </th>
            <th style="float: right;padding-top: 5px;">
                <div style="border-bottom: 2px solid #4890FD;"><p style="font-size: 1.3rem; padding: 0; margin: 0;">{{third_office['name']}}</h1></div>
                <p style="float: right; margin: 0;padding: 0; font-size: 1rem;">{{first_office_indexes[0]['name']}}</h3>
            </th>
            <th style="width: 5%;"> 
                <span style="height: 5.5vw;width: 5.5vw;background: radial-gradient(#75acff, #2b80ff );border-radius: 50%;float: left;"></span>
            </th>
        </tr>
        <tr>
            <table style="height: 60%; text-align: right;">
                <tr>
                    <th>
                        <div id="graph_div" style="width: 70vw; height: 35.5vw; margin: 0; padding: 0;">
                            <canvas id="lineChart" width="500" width="400" style="margin: 0; padding: 0;"></canvas>
                            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>                           
                            <script type="text/javascript">
                               var ctx = document.getElementById('lineChart').getContext('2d');
                                var myChart = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: {{ first_office_indexes[0]['lables'] | safe }},
                                        datasets: [{
                                            label: 'Example Dataset',
                                            data: {{ first_office_indexes[0]['values'] }},
                                            fill: true, 
                                            borderColor: '#4890FD',
                                            borderWidth: 2,
                                            lineTension: 0.5,
                                            backgroundColor: 'rgb(208, 226, 252)',
                                            pointRadius: 0,
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        plugins: {
                                        legend: {
                                            display: false
                                        }  
                                        },
                                        scales: {
                                            x: {
                                            grid: {
                                                display: false,
                                                }
                                            }
                                        }
                                    }
                                });
                            </script>
                        </div>
                    </th>
                    <th style="width: 80%; float: right; direction: rtl; padding:0;">
                        <p style="direction: rtl; font-size: 1rem; float: right;margin-right: 30px;">{{first_office_indexes[0]['info']}}</p>
                    </th>
                </tr>
            </table>
        </tr>
        <tr>

        </tr>
    </table>
</dialog>

<dialog policies-modal class="policies_modal">
    <button close_modal onclick="close_moadal()" id="close_button" >X</button>

    <table style="width: 100%; margin: 0px; padding: 0px;height: 10%;">
        <tr style="height: 30px;">
            <th>
            </th>
            <th style="width: 43%;">
               
            </th>
            <th style="float: right;padding-top: 5px;">
                <div style="border-bottom: 2px solid #cfcfcf;"><p style="font-size: 1.3rem; padding: 0; margin: 0;">{{third_office['name']}}</h1></div>
                <p style="float: right; margin: 0;padding: 0; font-size: 1rem;">{{first_office_indexes[1]['name']}}</h3>
            </th>
            <th style="width: 5%;">
                <span style="height: 5.5vw;width: 5.5vw;background: radial-gradient(#e3e3e3, #c3c3c3);border-radius: 50%;float: left;"></span>
            </th>
        </tr>
        <tr>
            <table style="height: 60%; text-align: right;">
                <tr>
                    <th>
                        <div id="graph_div" style="width: 70vw; height: 35.5vw; margin: 0; padding: 0;">
                            <canvas id="policies_chart" width="500" width="400" style="margin: 0; padding: 0;"></canvas>
                            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>                           
                            <script>
                                var ctx = document.getElementById('policies_chart').getContext('2d');
                                var myChart = new Chart(ctx, {
                                    type: '{{first_office_indexes[1]['chart_type']}}',
                                    data: {
                                        labels: {{ first_office_indexes[1]['lables'] | safe }},
                                        datasets: [{
                                            label: 'Example Dataset',
                                            data: {{ first_office_indexes[1]['values'] | safe }},
                                            fill: true, 
                                            borderColor: '#4890FD',
                                            backgroundColor: 'rgb(208, 226, 252)',
                                            borderWidth: 2,
                                            lineTension: 0.5
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        plugins: {
                                          legend: {
                                            display: false
                                          }  
                                        },
                                        scales: {
                                            x: {
                                            grid: {
                                                display: false,
                                                }
                                            }
                                        }
                                    }
                                });
                            </script>
                        </div>
                    </th>
                    <th style="width: 80%; float: right; direction: rtl; ">
                        <p style="direction: rtl; font-size: 1rem; float: right;margin-right: 30px;">{{first_office_indexes[1]['info']}}</p>
                    </th>
                </tr>
            </table>
        </tr>
        <tr>
        </tr>
    </table>
</dialog>

<dialog explain-modal class="explain_modal">
    <button close_modal onclick="close_moadal()" style="display: block;" id="close_button" >X</button>
    <img style="width: 145vh; height: 90vh; margin-left:6rem;" src="/static/images/offices/explain.png">
</dialog>


<script>
    const kpi_modal = document.querySelector("[kpi-modal]")
    const policies_modal = document.querySelector("[policies-modal]")
    const explain_modal = document.querySelector("[explain-modal]")
    const closeB = document.querySelector("[close_modal]")

    

    function close_moadal(){
        kpi_modal.close()
        policies_modal.close()
        explain_modal.close()
    }

    document.body.onclick = function(e) {   //when the document body is clicked
    if (window.event) {
        e = event.srcElement;           //assign the element clicked to e (IE 6-8)
    }
    else {
        e = e.target;                   //assign the element clicked to e
    }

    if (e.className && e.className.indexOf('kpi_bubble') != -1 || e.className && e.className.indexOf('kpi_icon') != -1 || e.className && e.className.indexOf('alert_bubble') != -1) {
        //if the element has a class name, and that is 'someclass' then...
        kpi_modal.showModal()
    } else if (e.className && e.className.indexOf('policies_bubble') != -1 || e.className && e.className.indexOf('policies_icon') != -1) {
        policies_modal.showModal()
    } else if (e.className && e.className.indexOf('explain_span') != -1 || e.className && e.className.indexOf('explain_icon') != -1) {
        explain_modal.showModal()
    }
    else{

    }
    
    // Add click event listener to all buttons with the class "send-btn"
    document.querySelectorAll('.kpi_bubble').forEach(button => {
            button.addEventListener('click', function() {
                // Get the ID of the clicked button
                const clickedId = this.id;
                
                // Send the clicked ID to Flask using fetch
                fetch('/handle_click', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: clickedId }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });
        });
}
</script>