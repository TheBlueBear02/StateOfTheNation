<link rel="stylesheet" href="{{ url_for('static', filename='parliament/election_style.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<div class="election-container">
    <h1 style="direction: rtl; text-align: right;">ממוצע 5 הסקרים האחרונים</h1>
    <canvas id="pollBarChart" width="100%"></canvas>
</div>

<div class="block-container">
    <h2 style="direction: rtl; text-align: right;">חלוקה לגושים</h2>
    <div class="block-bar" dir="rtl">
        {% set total_seats = block_seats | sum %}
        {% for i in range(block_labels|length) %}
            {% set block = block_labels[i] %}
            {% set seats = block_seats[i] %}
            {% set color = block_colors[i] %}
            {% set width = (seats / total_seats * 100) | round(2) %}
            <div class="block-segment"
                 style="width: {{ width }}%; background: {{ color }};">
                <div class="block-label">
                    <span class="block-name">{{ block }}</span>
                    <span class="block-seats">{{ seats }}</span>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    const partyLabels = {{ party_labels|tojson }};
    const partySeats = {{ party_seats|tojson }};
    const partyColors = {{ party_colors|tojson }};

    const ctx = document.getElementById('pollBarChart').getContext('2d');

    let chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: partyLabels,
            datasets: [{
                label: 'מספר מנדטים',
                data: partySeats,
                backgroundColor: partyColors,
                borderWidth: 0,
                borderRadius: 8,
                hoverBackgroundColor: partyColors.map(color => color + '95')
            }]
        },
        options: {
            plugins: {
                legend: { display: false },
                title: { display: false },
                datalabels: {
                    anchor: 'end',
                    align: 'start',
                    color: '#fff',
                    font: { weight: 'bold', size: 24 },
                    formatter: function(value) {
                        return value;
                    },
                    offset: 0,
                    clip: true
                }
            },
            layout: {
                padding: { bottom: 30 }
            },
            scales: {
                x: {
                    grid: { display: false, drawBorder: false },
                    ticks: {
                        font: { size: 14, weight: 'bold' },
                        color: '#222'
                    }
                },
                y: {
                    display: false,
                    grid: { display: false, drawBorder: false }
                }
            }
        },
        plugins: [ChartDataLabels]
    });

    // Block chart data from Flask
    const blockLabels = {{ block_labels|tojson }};
    const blockSeats = {{ block_seats|tojson }};
    const blockColors = {{ block_colors|tojson }};

    const blockCtx = document.getElementById('blockBarChart').getContext('2d');
    new Chart(blockCtx, {
        type: 'bar',
        data: {
            labels: blockLabels,
            datasets: [{
                data: blockSeats,
                backgroundColor: blockColors,
                borderWidth: 0,
                borderRadius: 0,
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold', size: 28 }
                }
            }]
        },
        options: {
            indexAxis: 'x', // horizontal bar
            plugins: {
                legend: { display: false },
                datalabels: {
                    anchor: 'center',
                    align: 'center',
                    color: '#fff',
                    font: { weight: 'bold', size: 28 },
                    formatter: function(value, context) {
                        return value;
                    }
                }
            },
            scales: {
                x: {
                    stacked: true,
                    grid: { display: false, drawBorder: false },
                    ticks: { display: false }
                },
                y: {
                    display: false,
                    grid: { display: false, drawBorder: false }
                }
            }
        },
        plugins: [ChartDataLabels]
    });
</script>



